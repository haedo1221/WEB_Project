{{>/layout/header}}

<div class="content_detail_box">
    <!-- detail page start -->
    <div class="detail_box">
        <!-- data box start -->
        <div class="data_box">
            <!-- img box start -->
            <div class="img_box">
                <div class="photo_box">
                    <div id="img" class="thumnail_img detail_thumnail_img_size">
                        <!--ìˆ˜ì •í•˜ê¸°-->
                        {{#restaurant.thumUrl}}<img src="{{restaurant.thumUrl}}"
                            class="detail_thumnail_img_size" />{{/restaurant.thumUrl}}{{^restaurant.thumUrl}}null{{/restaurant.thumUrl}}
                    </div>
                </div>
                <div class="map_box">
                    <div id="map" style="width:100%;height:100%; border-radius:10px;"></div>
                </div>
            </div>
            <!-- info start -->
            <div class="info_box">
                <div class="info_detail_box">
                    <div class="res_name d-flex">
                        <div class="ml-2 justify-content-center">
                            ğŸ”– {{restaurant.name}}
                        </div>
                    </div>
                    <div class="res_addr d-flex">
                        <div class="ml-2 justify-content-center">
                            ğŸ“ {{restaurant.address}}
                        </div>
                    </div>
                    <div class="res_tel d-flex">
                        <div class="ml-2 justify-content-center">
                            ğŸ“
                            {{#restaurant.telDisplay}}{{restaurant.telDisplay}}{{/restaurant.telDisplay}}{{^restaurant.telDisplay}}ì •ë³´
                            ì—†ìŒ{{/restaurant.telDisplay}}
                        </div>
                    </div>
                    <div class="res_hour d-flex">
                        <div class="ml-2 justify-content-center">
                            ğŸ•¦
                            {{#restaurant.bizhourInfo}}{{restaurant.bizhourInfo}}{{/restaurant.bizhourInfo}}{{^restaurant.bizhourInfo}}ì •ë³´
                            ì—†ìŒ{{/restaurant.bizhourInfo}}
                        </div>
                    </div>
                    <div class="res_link d-flex">
                        <div class="ml-2 justify-content-center">
                            ğŸ 
                            {{#restaurant.homePage}}{{restaurant.homePage}}{{/restaurant.homePage}}{{^restaurant.homePage}}ì •ë³´
                            ì—†ìŒ{{/restaurant.homePage}}
                        </div>
                    </div>
                    <div class="res_menu d-flex">
                        <div class="ml-2 justify-content-center">
                            ğŸ“–
                            {{#restaurant.menuInfo}}{{restaurant.menuInfo}}{{/restaurant.menuInfo}}{{^restaurant.menuInfo}}ì •ë³´
                            ì—†ìŒ{{/restaurant.menuInfo}}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- comment start -->
        <div class="data_box_2">
            <div class="comment_box">
                {{#principal}}
                <input id="postId" type="hidden" value="{{postId.id}}">
                <input id="userId" type="hidden" value="{{no}}">
                <button id="btn-love" class="btn btn_sm4 d-inline">
                    ë‹´ê¸°
                </button>
                {{/principal}}
                <!-- cbox write start -->

                <div class="cbox_write_area">
                    <form action="/s/post/{{postId.id}}/comment" method="post">
                        <div class="card-body d-flex align-items-center">
                            {{#principal}}
                            <textarea name="content" class="form-control mr-3" rows="2" cols="1"
                                placeholder="ëŒ“ê¸€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”."></textarea>
                            <button type="submit" class="btn btn_sm3">ë“±ë¡</button>
                            {{/principal}}
                            {{^principal}}
                            <a class="form-control mr-3" style="text-decoration: none;" href="/login-form"
                                title="ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™" readonly>
                                ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.
                            </a>
                            <button type="submit" class="btn btn_sm3" title="ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤." disabled>ë“±ë¡</button>
                            {{/principal}}
                        </div>
                    </form>
                </div>
                <div class="cbox_view_comment">
                    <div class="cbox_comment_box">
                        <ul id="reply-box" class="list-group">
                            {{#comments}}
                            <li class="list-group-item">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <div class="font-italic">
                                            <dt>{{comment.user.id}} &nbsp;</dt>
                                        </div>
                                        <div> {{comment.content}}</div>
                                    </div>
                                    <div class="d-flex">
                                        {{#auth}}
                                        <button class="badge bg-white align-items-center"
                                            onclick="deleteComment('{{comment.id}}');">ì‚­ì œ</button>
                                        {{/auth}}
                                    </div>
                                </div>
                            </li>
                            {{/comments}}
                        </ul>
                    </div>
                </div>
            </div>
            <!-- cbox view start -->
        </div>
    </div>
</div>

<script>
    let x = "{{restaurant.x}}";
    let y = "{{restaurant.y}}";

    console.log(x);
    console.log(y);

    var mapOptions = {
        center: new naver.maps.LatLng(y, x),
        zoom: 10
    };

    var map = new naver.maps.Map('map', mapOptions);

    var marker = new naver.maps.Marker({
        position: new naver.maps.LatLng(y, x),
        map: map
    });

    // ëŒ“ê¸€ ì‚­ì œ
    async function deleteComment(commentId) {
        let response = await fetch(`/s/comment/${commentId}`, {
            method: "DELETE"
        });
        let responseParse = await response.json();
        if (responseParse.code == 1) {
            alert("ì‚­ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
            location.reload(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ajax + ssr
        } else {
            alert("ì‚­ì œì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.");
        }
    }

    // ë‹´ê¸° ì´ë²¤íŠ¸
    $("#btn-love").click(() => {
        let result = confirm("ì´ ê¸€ì„ ë‹´ìœ¼ì‹œê² ìŠµë‹ˆê¹Œ?");
        if (result) {
            love();
        }
    });

    // ë‹´ê¸°
    async function love() {

        let loveDto = {
            postId: $("#postId").val(),
            userId: $("#userId").val()
        };

        let postId = $("#postId").val();

        let response = await fetch(`/s/post/${postId}/love`, {
            method: "POST",
            body: JSON.stringify(loveDto),
            headers: {
                "Content-Type": "application/json; charset=utf-8"
            }
        });
        
        let responseParse = await response.json();
        console.log(responseParse);
        if (responseParse==1) {
            alert("ë‹´ê¸° ì™„ë£Œ");
            location.reload(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ajax + ssr
        } else {
            alert("ì´ë¯¸ ë‹´ì€ ê²Œì‹œê¸€ì…ë‹ˆë‹¤");
        }
    }
</script>

{{>/layout/footer}}